<?xml version="1.0" ?>
<robot name="two_links">
  <material name="red">
    <color rgba="1 0 0 1"/>
  </material>
  <material name="blue">
    <color rgba="0 0 1 1"/>
  </material>
  <material name="green">
    <color rgba="0 1 0 1"/>
  </material>
  <gazebo reference="base_link">
    <static>true</static>
    <material>Gazebo/Blue</material>
  </gazebo>
  <gazebo reference="link1">
    <material>Gazebo/Red</material>
  </gazebo>
  <gazebo reference="link2">
    <material>Gazebo/Green</material>
  </gazebo>
  <link name="base_link">
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <inertial>
      <mass value="10.0"/>
      <inertia ixx="0.1" iyy="0.1" izz="0.1" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
      <material name="blue"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.1 0.1 0.1"/>
      </geometry>
    </collision>
  </link>
  <link name="link1">
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <geometry>
        <box size="0.4 0.05 0.05"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0.2 0 0"/>
      <material name="red"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.4 0.05 0.05"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0.2 0 0"/>
    </collision>
  </link>
  <link name="link2">
    <origin rpy="0 0 0" xyz="0.4 0.0 0"/>
    <inertial>
      <mass value="0.3"/>
      <inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
    <visual>
      <geometry>
        <box size="0.3 0.05 0.05"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0.15 0 0"/>
      <material name="green"/>
    </visual>
    <collision>
      <geometry>
        <box size="0.3 0.05 0.05"/>
      </geometry>
      <origin rpy="0 0 0" xyz="0.15 0 0"/>
    </collision>
  </link>

  <joint name="joint1" type="revolute">
    <parent link="base_link"/>
    <child link="link1"/>
    <origin rpy="0 0 0.05" xyz="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
  </joint>
  <joint name="joint2" type="revolute">
    <parent link="link1"/>
    <child link="link2"/>
    <axis xyz="0 0 1"/>
    <limit effort="10" lower="-1.57" upper="1.57" velocity="1.0"/>
    <origin xyz="0.4 0 0"/>
  </joint>
  <ros2_control name="GazeboSystem" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>
    <joint name="joint1">
      <param name="pos_kp">10</param>
      <param name="pos_ki">1</param>
      <param name="pos_kd">2</param>
      <param name="pos_max_integral_error">10000</param>
      <param name="vel_kp">10</param>
      <param name="vel_ki">5</param>
      <param name="vel_kd">2</param>
      <param name="vel_max_integral_error">10000</param>
      <command_interface name="position"/>
      <command_interface name="velocity"/>

      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
    <joint name="joint2">
      <param name="pos_kp">10</param>
      <param name="pos_ki">1</param>
      <param name="pos_kd">2</param>
      <param name="pos_max_integral_error">10000</param>
      <param name="vel_kp">10</param>
      <param name="vel_ki">5</param>
      <param name="vel_kd">2</param>
      <param name="vel_max_integral_error">10000</param>
      <command_interface name="position"/>
      <command_interface name="velocity"/>

      <state_interface name="position">
        <param name="initial_value">0.0</param>
      </state_interface>
      <state_interface name="velocity"/>
      <state_interface name="effort"/>
    </joint>
  </ros2_control>

  <gazebo>
    <!-- The following plug-in publishes the joint states for joint1 and joint2 via the ROS topic /joint_states-->
  <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
    <ros>
      <namespace>/</namespace>
      <remapping>joint_states:=/joint_states</remapping>
    </ros>
    <update_rate>50.0</update_rate>
    <joint_name>joint1</joint_name>
    <joint_name>joint2</joint_name>
  </plugin>

  <plugin name="gazebo_ros2_control" filename="libgazebo_ros2_control.so" >
    <parameters>week_3/config/joints_controller.yaml</parameters>
  </plugin>
  </gazebo>
</robot>
